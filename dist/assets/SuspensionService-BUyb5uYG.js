import{A as g,G as $,F as y,E as u,v as n,H as w,y as S,t as m,I as M,bb as p}from"./index-D1L_5H5X.js";const h={time:{dayStartHour:7,dayStartMinute:30,nightStartHour:23,nightStartMinute:0,weekendExtensionMinutes:0},tzd:{triggerChance:.08,tzdMaxHours:36,lockInventory:!0,zoneWeights:[.2,.5,.3]},purity:{cleanChance:.6,allowBegging:!0,beggingSuccessChance:.5},instruction:{forcedReleaseTriggerChance:.15,forcedReleaseMethods:{hand:.34,toy_vaginal:.33,toy_anal:.33}},punishment:{defaultDurationMinutes:60,refusalMultiplier:1.5,showTimer:!0}},r="suspensions",A=async(a,e)=>{const s=new Date(e.startDate),t=new Date;if(t.setHours(23,59,59,999),s<=t)throw new Error("Unzulässig: Aussetzungen müssen mindestens für den Folgetag geplant werden.");await M(u(n,`users/${a}/${r}`),{type:e.type,reason:e.reason,startDate:p.fromDate(new Date(e.startDate)),endDate:p.fromDate(new Date(e.endDate)),createdAt:p.now(),status:"scheduled"})},b=async a=>{const e=g(u(n,`users/${a}/${r}`),y("status","in",["scheduled","active"]),$("startDate","asc"));return(await w(e)).docs.map(t=>({id:t.id,...t.data(),startDate:t.data().startDate.toDate(),endDate:t.data().endDate.toDate()}))},q=async a=>{try{const e=g(u(n,`users/${a}/${r}`),$("startDate","desc"));return(await w(e)).docs.map(t=>{var c,D;return{id:t.id,...t.data(),startDate:(c=t.data().startDate)!=null&&c.toDate?t.data().startDate.toDate():new Date(t.data().startDate),endDate:(D=t.data().endDate)!=null&&D.toDate?t.data().endDate.toDate():new Date(t.data().endDate)}})}catch(e){return console.error("Error loading history:",e),[]}},z=async a=>{const e=new Date,s=(h==null?void 0:h.time)||{dayStartHour:7,dayStartMinute:30,nightStartHour:23,nightStartMinute:0},t=g(u(n,`users/${a}/${r}`),y("status","==","active")),c=await w(t);if(!c.empty){const o=c.docs[0],i=o.data(),d=i.endDate.toDate(),l=new Date(d);return l.setHours(s.nightStartHour,s.nightStartMinute,0,0),l<e?(await S(m(n,`users/${a}/${r}`,o.id),{status:"completed"}),null):{id:o.id,...i,startDate:i.startDate.toDate(),endDate:d}}const D=g(u(n,`users/${a}/${r}`),y("status","==","scheduled")),H=await w(D);for(const o of H.docs){const i=o.data(),d=i.startDate.toDate(),l=i.endDate.toDate(),f=new Date(d);if(f.setHours(s.dayStartHour,s.dayStartMinute,0,0),f<=e)return await S(m(n,`users/${a}/${r}`,o.id),{status:"active"}),{id:o.id,...i,status:"active",startDate:d,endDate:l}}return null},C=async(a,e)=>{await S(m(n,`users/${a}/${r}`,e),{status:"terminated",terminatedAt:p.now()})};export{h as D,b as a,A as b,z as c,q as g,C as t};
