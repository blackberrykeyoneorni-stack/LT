import{p as le,q as ue,j as de,u as Re,r as S,A as Ee,G as Ne,F as Ve,E as Le,v as re,K as ie,t as _e}from"./index-Bn0040C1.js";var U={},He=le;Object.defineProperty(U,"__esModule",{value:!0});var Oe=U.default=void 0,qe=He(ue()),ke=de;Oe=U.default=(0,qe.default)((0,ke.jsx)("path",{d:"M9 1h6v2H9zm10.03 6.39 1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61M13 14h-2V8h2z"}),"Timer");const H=new Date("2025-12-15T00:00:00"),m=a=>typeof a=="number"?a.toFixed(1):"0.0",ce=a=>typeof a=="number"?a.toFixed(2):"0.00",Ae=a=>{const f=new Date,l=new Date(f);l.setDate(f.getDate()-7);const r=a.filter(n=>{const t=n.startTime.toDate?n.startTime.toDate():new Date(n.startTime);return(n.endTime?n.endTime.toDate?n.endTime.toDate():new Date(n.endTime):new Date)>l&&t<f}).map(n=>{const t=n.startTime.toDate?n.startTime.toDate():new Date(n.startTime),o=n.endTime?n.endTime.toDate?n.endTime.toDate():new Date(n.endTime):new Date;return{start:Math.max(t.getTime(),l.getTime()),end:Math.min(o.getTime(),f.getTime())}}).filter(n=>n.end>n.start);if(r.length===0)return 0;r.sort((n,t)=>n.start-t.start);const w=[];let i=r[0];for(let n=1;n<r.length;n++)r[n].start<i.end?i.end=Math.max(i.end,r[n].end):(w.push(i),i=r[n]);w.push(i);const h=w.reduce((n,t)=>n+(t.end-t.start),0),u=7*24*60*60*1e3;return Math.min(100,h/u*100)},Pe=(a,f,l)=>f.some(s=>{const r=s.startTime.toDate?s.startTime.toDate():new Date(s.startTime),w=s.endTime?s.endTime.toDate?s.endTime.toDate():new Date(s.endTime):new Date;return a>=r&&a<=w?(s.itemIds||(s.itemId?[s.itemId]:[])).some(h=>{const u=l.find(t=>t.id===h);return u?(u.subCategory||"").toLowerCase().includes("strumpfhose"):!1}):!1}),je=(a,f,l)=>{const s=new Date(a);s.setHours(0,0,0,0);const r=new Date(a);r.setHours(23,59,59,999);const i=f.filter(t=>{const o=t.startTime.toDate?t.startTime.toDate():new Date(t.startTime),T=t.endTime?t.endTime.toDate?t.endTime.toDate():new Date(t.endTime):new Date;return o>r||T<s?!1:(t.itemIds||(t.itemId?[t.itemId]:[])).some(C=>{const x=l.find(O=>O.id===C);if(!x)return!1;const R=(x.mainCategory||"").toLowerCase(),I=(x.subCategory||"").toLowerCase();return R.includes("nylon")||I.includes("strumpfhose")||I.includes("stockings")})}).map(t=>{const o=t.startTime.toDate?t.startTime.toDate():new Date(t.startTime),T=t.endTime?t.endTime.toDate?t.endTime.toDate():new Date(t.endTime):new Date;return{start:Math.max(o.getTime(),s.getTime()),end:Math.min(T.getTime(),r.getTime())}}).filter(t=>t.end>t.start);if(i.length===0)return 0;i.sort((t,o)=>t.start-o.start);const h=[];let u=i[0];for(let t=1;t<i.length;t++)i[t].start<u.end?u.end=Math.max(u.end,i[t].end):(h.push(u),u=i[t]);h.push(u);const n=h.reduce((t,o)=>t+(o.end-o.start),0);return Math.floor(n/6e4)};function Be(a,f,l){const{currentUser:s}=Re(),[r,w]=S.useState({totalReleases:0,cleanReleases:0,keptOn:0}),[i,h]=S.useState([]),[u,n]=S.useState({health:{orphanCount:0},financials:{avgCPW:"0.00"},usage:{nylonIndex:"0.0"},spermaScore:{rate:"0.0",total:0,count:0},coreMetrics:{nylonEnclosure:"0.0",nocturnal:"0.0",nylonGap:"0.0",cpnh:"0.00",complianceLag:"0.0",coverage:"0.0",resistance:"0.0",voluntarism:"0.0%",endurance:"0.0",enduranceNylon:"0.0",enduranceDessous:"0.0",submission:"85.0",denial:"12.0",chastity:"0.0"},femIndex:{score:0,trend:"neutral"},basics:{activeItems:0,washing:0,wornToday:0,archived:0}});return S.useEffect(()=>{if(s&&l===void 0){const t=Ee(Le(re,`users/${s.uid}/sessions`),Ve("startTime",">=",H),Ne("startTime","desc")),o=ie(t,T=>{const p=T.docs.map(C=>({id:C.id,...C.data()}));h(p)});return()=>o()}},[s,l]),S.useEffect(()=>{if(!s)return;const t=_e(re,`users/${s.uid}/stats/releaseStats`),o=ie(t,T=>{if(T.exists()){const p=T.data();w({totalReleases:Number(p.totalReleases)||0,cleanReleases:Number(p.cleanReleases)||0,keptOn:Number(p.keptOn)||0})}});return()=>o()},[s]),S.useEffect(()=>{if(!Array.isArray(a))return;let t=[];l!==void 0?t=l:i.length>0?t=i:t=f||[];const o=t.filter(e=>(e.startTime.toDate?e.startTime.toDate():new Date(e.startTime))>=H),T=a.filter(e=>e.status==="active"),p=a.filter(e=>e.status==="washing"),C=a.filter(e=>e.status==="archived"),x=a.filter(e=>e.status==="active"&&(!e.wearCount||e.wearCount===0)).length;let R=0,I=0;a.forEach(e=>{R+=parseFloat(e.cost)||0,I+=parseInt(e.wearCount)||0});const O=I>0?R/I:0,J=a.filter(e=>e.status!=="archived"&&(e.mainCategory&&e.mainCategory==="Nylons"||e.subCategory&&e.subCategory.toLowerCase().includes("strumpfhose"))),E=new Date,N=new Date;N.setDate(E.getDate()-30);const me=t.filter(e=>(e.endTime?e.endTime.toDate?e.endTime.toDate():new Date(e.endTime):new Date)>=N);let Q=0;const q=new Set;me.forEach(e=>{const c=e.itemIds||(e.itemId?[e.itemId]:[]);let b=!1;if(c.forEach(d=>{const M=a.find(K=>K.id===d);if(!M)return;const g=M.mainCategory||"",v=(M.subCategory||"").toLowerCase();(g==="Nylons"||v.includes("strumpfhose")||v.includes("stockings"))&&(b=!0,q.add(d))}),b){const d=e.startTime.toDate?e.startTime.toDate():new Date(e.startTime),M=e.endTime?e.endTime.toDate?e.endTime.toDate():new Date(e.endTime):new Date,g=d<N?N:d,v=M;v>g&&(Q+=(v-g)/6e4)}});const X=q.size>0?Q/q.size/60:0,fe=J.reduce((e,c)=>e+(Number(c.totalMinutes)||0),0),De=J.reduce((e,c)=>e+(Number(c.cost)||0),0),Z=fe/60,Te=Z>0?De/Z:0,he=Ae(t);let k=0,ee=0;const V=new Date(H);for(;V<=E;){k++;const e=new Date(V);e.setHours(2,0,0,0),e<=E&&Pe(e,t,a)&&ee++,V.setDate(V.getDate()+1)}const te=k>0?ee/k*100:0;let ne=0,A=0;const L=new Date(H);for(;L<=E;){A++;const e=je(L,t,a);ne+=(1440-e)/60,L.setDate(L.getDate()+1)}const ge=A>0?ne/A:24;let P=0,ae=0;o.forEach(e=>{const c=e.startTime.toDate?e.startTime.toDate():new Date(e.startTime),b=e.endTime?e.endTime.toDate?e.endTime.toDate():new Date(e.endTime):new Date,d=Math.max(0,b.getTime()-c.getTime());P+=d,e.type==="voluntary"&&(ae+=d)});const ye=P>0?ae/P*100:0,we=o.filter(e=>e.type==="punishment"),pe=o.length>0?we.length/o.length*100:0,ve=o.filter(e=>e.startTime);let _=0,j=0,z=0,$=0,se=0,G=0;ve.forEach(e=>{const c=e.startTime.toDate?e.startTime.toDate():new Date(e.startTime),b=e.endTime?e.endTime.toDate?e.endTime.toDate():new Date(e.endTime):new Date,d=Math.max(0,(b-c)/36e5),g=(e.itemIds||(e.itemId?[e.itemId]:[])).map(D=>a.find(y=>y.id===D)).filter(D=>D);if(g.length===0)return;const v=g.some(D=>{const y=(D.subCategory||"").toLowerCase();return(D.mainCategory||"").toLowerCase().includes("nylon")||y.includes("strumpfhose")||y.includes("stockings")}),K=g.some(D=>{const y=(D.subCategory||"").toLowerCase(),B=(D.mainCategory||"").toLowerCase();return B.includes("dessous")||B.includes("wÃ¤sche")||y.includes("body")});g.every(D=>{const y=(D.mainCategory||"").toLowerCase();return y==="accessoires"||y==="schuhe"})||(_+=d,j++),v&&(z+=d,$++),K&&(se+=d,G++)});const Ce=j>0?_/j:0,Ie=$>0?z/$:0,be=G>0?se/G:0,W=_>0?z/_*100:0,Me=r.totalReleases>0?r.cleanReleases/r.totalReleases*100:0,Se=Math.round(W*.3+te*.2+X*2),oe=new Date;oe.setHours(0,0,0,0);const xe=t.filter(e=>e.startTime?(e.startTime.toDate?e.startTime.toDate():new Date(e.startTime))>=oe:!1),F=new Set;xe.forEach(e=>{e.itemId&&F.add(e.itemId),e.itemIds&&e.itemIds.forEach(c=>F.add(c))}),n({health:{orphanCount:x},financials:{avgCPW:ce(O)},usage:{nylonIndex:m(X)},spermaScore:{rate:m(Me),total:r.totalReleases,count:r.cleanReleases},coreMetrics:{nylonEnclosure:m(W),nocturnal:m(te),nylonGap:m(ge),cpnh:ce(Te),complianceLag:"12.0",coverage:m(he),resistance:m(pe),voluntarism:m(ye)+"%",endurance:m(Ce),enduranceNylon:m(Ie),enduranceDessous:m(be),submission:"85.0",denial:"12.0",chastity:m(W)},femIndex:{score:Math.min(100,Se),trend:"stable"},basics:{activeItems:T.length,washing:p.length,wornToday:F.size,archived:C.length}})},[a,f,l,i,r]),u}var Y={},ze=le;Object.defineProperty(Y,"__esModule",{value:!0});var $e=Y.default=void 0,Ge=ze(ue()),We=de;$e=Y.default=(0,Ge.default)((0,We.jsx)("path",{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11z"}),"Security");export{Oe as a,$e as d,Be as u};
