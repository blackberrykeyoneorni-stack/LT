import{p as ce,q as ue,j as le,u as xe,r as I,A as Re,G as Se,F as Ee,E as Ne,v as re,K as ie,t as Fe}from"./index-irBeTQ3W.js";var B={},Le=ce;Object.defineProperty(B,"__esModule",{value:!0});var _e=B.default=void 0,He=Le(ue()),Oe=le;_e=B.default=(0,He.default)((0,Oe.jsx)("path",{d:"M9 1h6v2H9zm10.03 6.39 1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61M13 14h-2V8h2z"}),"Timer");const O=new Date("2025-12-15T00:00:00"),qe=(s,g,f)=>g.some(n=>{const r=n.startTime.toDate?n.startTime.toDate():new Date(n.startTime),x=n.endTime?n.endTime.toDate?n.endTime.toDate():new Date(n.endTime):new Date;return s>=r&&s<=x?(n.itemIds||(n.itemId?[n.itemId]:[])).some(T=>{const u=f.find(t=>t.id===T);return u?(u.subCategory||"").toLowerCase().includes("strumpfhose"):!1}):!1}),ke=(s,g,f)=>{const n=new Date(s);n.setHours(0,0,0,0);const r=new Date(s);r.setHours(23,59,59,999);const i=g.filter(t=>{const a=t.startTime.toDate?t.startTime.toDate():new Date(t.startTime),d=t.endTime?t.endTime.toDate?t.endTime.toDate():new Date(t.endTime):new Date;return a>r||d<n?!1:(t.itemIds||(t.itemId?[t.itemId]:[])).some(p=>{const b=f.find(q=>q.id===p);if(!b)return!1;const S=(b.mainCategory||"").toLowerCase(),w=(b.subCategory||"").toLowerCase();return S.includes("nylon")||w.includes("strumpfhose")||w.includes("stockings")})}).map(t=>{const a=t.startTime.toDate?t.startTime.toDate():new Date(t.startTime),d=t.endTime?t.endTime.toDate?t.endTime.toDate():new Date(t.endTime):new Date;return{start:Math.max(a.getTime(),n.getTime()),end:Math.min(d.getTime(),r.getTime())}}).filter(t=>t.end>t.start);if(i.length===0)return 0;i.sort((t,a)=>t.start-a.start);const T=[];let u=i[0];for(let t=1;t<i.length;t++)i[t].start<u.end?u.end=Math.max(u.end,i[t].end):(T.push(u),u=i[t]);T.push(u);const R=T.reduce((t,a)=>t+(a.end-a.start),0);return Math.floor(R/6e4)};function Ve(s,g,f){const{currentUser:n}=xe(),[r,x]=I.useState({totalReleases:0,cleanReleases:0,keptOn:0}),[i,T]=I.useState([]),[u,R]=I.useState({health:{orphanCount:0},financials:{avgCPW:0},usage:{nylonIndex:0},spermaScore:{rate:0,total:0,count:0},coreMetrics:{nylonEnclosure:0,nocturnal:0,nylonGap:0,cpnh:0,complianceLag:0,exposure:0,resistance:0,voluntarism:0,endurance:0,enduranceNylon:0,enduranceDessous:0,submission:85,denial:12,chastity:0},femIndex:{score:0,trend:"neutral"},basics:{activeItems:0,washing:0,wornToday:0,archived:0}});return I.useEffect(()=>{if(n&&f===void 0){const t=Re(Ne(re,`users/${n.uid}/sessions`),Ee("startTime",">=",O),Se("startTime","desc")),a=ie(t,d=>{const h=d.docs.map(p=>({id:p.id,...p.data()}));T(h)});return()=>a()}},[n,f]),I.useEffect(()=>{if(!n)return;const t=Fe(re,`users/${n.uid}/stats/releaseStats`),a=ie(t,d=>{if(d.exists()){const h=d.data();x({totalReleases:Number(h.totalReleases)||0,cleanReleases:Number(h.cleanReleases)||0,keptOn:Number(h.keptOn)||0})}});return()=>a()},[n]),I.useEffect(()=>{if(!Array.isArray(s))return;let t=[];f!==void 0?t=f:i.length>0?t=i:t=g||[];const a=t.filter(e=>(e.startTime.toDate?e.startTime.toDate():new Date(e.startTime))>=O),d=s.filter(e=>e.status==="active"),h=s.filter(e=>e.status==="washing"),p=s.filter(e=>e.status==="archived"),b=s.filter(e=>e.status==="active"&&(!e.wearCount||e.wearCount===0)).length;let S=0,w=0;s.forEach(e=>{S+=parseFloat(e.cost)||0,w+=parseInt(e.wearCount)||0});const q=w>0?S/w:0,Y=s.filter(e=>e.status!=="archived"&&(e.mainCategory&&e.mainCategory==="Nylons"||e.subCategory&&e.subCategory.toLowerCase().includes("strumpfhose"))),E=new Date,N=new Date;N.setDate(E.getDate()-30);const de=t.filter(e=>(e.endTime?e.endTime.toDate?e.endTime.toDate():new Date(e.endTime):new Date)>=N);let J=0;const k=new Set;de.forEach(e=>{const o=e.itemIds||(e.itemId?[e.itemId]:[]);let M=!1;if(o.forEach(c=>{const v=s.find(oe=>oe.id===c);if(!v)return;const D=v.mainCategory||"",y=(v.subCategory||"").toLowerCase();(D==="Nylons"||y.includes("strumpfhose")||y.includes("stockings"))&&(M=!0,k.add(c))}),M){const c=e.startTime.toDate?e.startTime.toDate():new Date(e.startTime),v=e.endTime?e.endTime.toDate?e.endTime.toDate():new Date(e.endTime):new Date,D=c<N?N:c,y=v;if(y>D){const H=y-D;J+=H/6e4}}});const Q=k.size>0?J/k.size/60:0,me=Y.reduce((e,o)=>e+(Number(o.totalMinutes)||0),0),fe=Y.reduce((e,o)=>e+(Number(o.cost)||0),0),X=me/60,De=X>0?parseFloat((fe/X).toFixed(2)):0;let A=0,Z=0;const F=new Date(O);for(;F<=E;){A++;const e=new Date(F);e.setHours(2,0,0,0),e<=E&&qe(e,t,s)&&Z++,F.setDate(F.getDate()+1)}const ee=A>0?Math.round(Z/A*100):0;let te=0,j=0;const L=new Date(O);for(;L<=E;){j++;const o=1440-ke(L,t,s);te+=o/60,L.setDate(L.getDate()+1)}const he=j>0?te/j:24;let z=0,ne=0;a.forEach(e=>{const o=e.startTime.toDate?e.startTime.toDate():new Date(e.startTime),M=e.endTime?e.endTime.toDate?e.endTime.toDate():new Date(e.endTime):new Date,c=Math.max(0,M.getTime()-o.getTime());z+=c,e.type==="voluntary"&&(ne+=c)});const Te=z>0?Math.round(ne/z*100):0,ye=a.filter(e=>e.type==="punishment"),ge=a.length>0?Math.round(ye.length/a.length*100):0,pe=a.filter(e=>e.endTime&&e.startTime);let _=0,$=0,G=0,P=0,se=0,V=0;pe.forEach(e=>{const o=e.startTime.toDate?e.startTime.toDate():new Date(e.startTime),c=((e.endTime.toDate?e.endTime.toDate():new Date(e.endTime))-o)/36e5,D=(e.itemIds||(e.itemId?[e.itemId]:[])).map(l=>s.find(m=>m.id===l)).filter(l=>l);if(D.length===0)return;const y=D.some(l=>{const m=(l.mainCategory||"").toLowerCase(),C=(l.subCategory||"").toLowerCase();return m.includes("nylon")||C.includes("strumpfhose")||C.includes("stockings")}),H=D.some(l=>{const m=(l.mainCategory||"").toLowerCase(),C=(l.subCategory||"").toLowerCase();return m.includes("dessous")||m.includes("wÃ¤sche")||m.includes("corsage")||C.includes("body")||C.includes("bh")||C.includes("slip")});D.every(l=>{const m=(l.mainCategory||"").toLowerCase();return m==="accessoires"||m==="schuhe"})||(_+=c,$++),y&&(G+=c,P++),H&&(se+=c,V++)});const we=$>0?parseFloat((_/$).toFixed(1)):0,ve=P>0?parseFloat((G/P).toFixed(1)):0,Ce=V>0?parseFloat((se/V).toFixed(1)):0,W=_>0?Math.round(G/_*100):0,Ie={rate:r.totalReleases>0?Math.round(r.cleanReleases/r.totalReleases*100):0,total:r.totalReleases,count:r.cleanReleases},be=Math.round(W*.3+ee*.2+Q*2),ae=new Date;ae.setHours(0,0,0,0);const Me=t.filter(e=>e.startTime?(e.startTime.toDate?e.startTime.toDate():new Date(e.startTime))>=ae:!1),K=new Set;Me.forEach(e=>{e.itemId&&K.add(e.itemId),e.itemIds&&e.itemIds.forEach(o=>K.add(o))}),R({health:{orphanCount:b},financials:{avgCPW:q},usage:{nylonIndex:parseFloat(Q.toFixed(1))},spermaScore:Ie,coreMetrics:{nylonEnclosure:W,nocturnal:ee,nylonGap:parseFloat(he.toFixed(1)),cpnh:De,complianceLag:12,exposure:45,resistance:ge,voluntarism:Te,endurance:we,enduranceNylon:ve,enduranceDessous:Ce,submission:85,denial:12,chastity:W},femIndex:{score:Math.min(100,be),trend:"stable"},basics:{activeItems:d.length,washing:h.length,wornToday:K.size,archived:p.length}})},[s,g,f,i,r]),u}var U={},Ae=ce;Object.defineProperty(U,"__esModule",{value:!0});var je=U.default=void 0,ze=Ae(ue()),$e=le;je=U.default=(0,ze.default)((0,$e.jsx)("path",{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11z"}),"Security");export{_e as a,je as d,Ve as u};
