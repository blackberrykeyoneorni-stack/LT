import{g as z,b as _,r as u,d as B,_ as R,e as D,j as e,s as M,f as k,T as C,h as F,i as U,u as G,x as H,E as q,y as w,p as I,H as O,B as y,M as K,D as i,C as J,P as r,$ as Q,a1 as V,aO as X,a as $,aN as Y,o as L,q as Z,F as ee,w as te,bo as se}from"./index-ixkxW-QW.js";import{d as ne}from"./CheckCircle-5T3-TOQu.js";import{d as ae}from"./Savings-LLl8g0gY.js";import{C as W}from"./Modal-CtVcV48E.js";import{u as ie,d as re,S as A,T as E}from"./TextField-BML8lclq.js";import{D as oe,a as le,b as ce}from"./DialogTitle-OpCTMrYj.js";import{D as de}from"./DialogActions-CY52xkx4.js";function pe(s){return _("MuiInputAdornment",s)}const N=z("MuiInputAdornment",["root","filled","standard","outlined","positionStart","positionEnd","disablePointerEvents","hiddenLabel","sizeSmall"]);var T;const ue=["children","className","component","disablePointerEvents","disableTypography","position","variant"],xe=(s,n)=>{const{ownerState:o}=s;return[n.root,n[`position${F(o.position)}`],o.disablePointerEvents===!0&&n.disablePointerEvents,n[o.variant]]},me=s=>{const{classes:n,disablePointerEvents:o,hiddenLabel:c,position:d,size:x,variant:f}=s,b={root:["root",o&&"disablePointerEvents",d&&`position${F(d)}`,f,c&&"hiddenLabel",x&&`size${F(x)}`]};return U(b,pe,n)},he=M("div",{name:"MuiInputAdornment",slot:"Root",overridesResolver:xe})(({theme:s,ownerState:n})=>D({display:"flex",height:"0.01em",maxHeight:"2em",alignItems:"center",whiteSpace:"nowrap",color:(s.vars||s).palette.action.active},n.variant==="filled"&&{[`&.${N.positionStart}&:not(.${N.hiddenLabel})`]:{marginTop:16}},n.position==="start"&&{marginRight:8},n.position==="end"&&{marginLeft:8},n.disablePointerEvents===!0&&{pointerEvents:"none"})),ge=u.forwardRef(function(n,o){const c=B({props:n,name:"MuiInputAdornment"}),{children:d,className:x,component:f="div",disablePointerEvents:b=!1,disableTypography:g=!1,position:a,variant:m}=c,S=R(c,ue),h=ie()||{};let l=m;m&&h.variant,h&&!l&&(l=h.variant);const t=D({},c,{hiddenLabel:h.hiddenLabel,size:h.size,disablePointerEvents:b,position:a,variant:l}),p=me(t);return e.jsx(re.Provider,{value:null,children:e.jsx(he,D({as:f,ownerState:t,className:k(p.root,x),ref:o},S,{children:typeof d=="string"&&!g?e.jsx(C,{color:"text.secondary",children:d}):e.jsxs(u.Fragment,{children:[a==="start"?T||(T=e.jsx("span",{className:"notranslate",children:"​"})):null,d]})}))})});function Se(){const{currentUser:s}=G(),[n,o]=u.useState(!0),[c,d]=u.useState([]),[x,f]=u.useState({limit:0,spent:0}),[b,g]=u.useState(!1),[a,m]=u.useState({name:"",price:"",priority:"medium"});u.useEffect(()=>{if(!s)return;const t=H(w(I,`users/${s.uid}/wishlist`),q("createdAt","desc")),p=O(t,j=>{const v=j.docs.map(P=>({id:P.id,...P.data(),price:parseFloat(P.data().price)||parseFloat(P.data().estimatedCost)||0}));d(v),o(!1)});return(async()=>{try{const j=L(I,`users/${s.uid}/settings/budget`),v=await Z(j);v.exists()&&f({limit:v.data().monthlyLimit||0,spent:v.data().currentSpent||0})}catch(j){console.error(j)}})(),()=>p()},[s]);const S=async()=>{if(a.name)try{await ee(w(I,`users/${s.uid}/wishlist`),{name:a.name,price:parseFloat(a.price)||0,priority:a.priority,createdAt:te()}),g(!1),m({name:"",price:"",priority:"medium"})}catch(t){console.error(t)}},h=async t=>{window.confirm("Löschen?")&&await se(L(I,`users/${s.uid}/wishlist`,t))},l=x.limit-x.spent;return n?e.jsx(y,{sx:{display:"flex",justifyContent:"center",mt:10},children:e.jsx(K,{})}):e.jsx(y,{sx:i.bottomNavSpacer,children:e.jsxs(J,{maxWidth:"sm",sx:{pt:2},children:[e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(C,{variant:"h4",sx:i.textGradient,children:"Wishlist"}),e.jsx(W,{icon:e.jsx(ae,{}),label:`${l.toFixed(2)} €`,sx:{bgcolor:l>0?`${r.accents.green}22`:`${r.accents.red}22`,color:l>0?r.accents.green:r.accents.red,border:`1px solid ${l>0?r.accents.green:r.accents.red}`}})]}),e.jsx(A,{spacing:2,children:c.length===0?e.jsx(C,{variant:"body1",color:"text.secondary",align:"center",sx:{mt:5},children:"Leer."}):c.map(t=>{const p=l>=t.price;return e.jsx(Q,{sx:{p:2,...i.glassCard,borderLeft:p?`4px solid ${r.accents.green}`:"4px solid transparent",opacity:p?1:.7},children:e.jsxs(y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs(y,{children:[e.jsx(C,{variant:"subtitle1",sx:{fontWeight:"bold"},children:t.name}),e.jsxs(A,{direction:"row",spacing:1,sx:{mt:.5,alignItems:"center"},children:[e.jsx(W,{label:`${t.price.toFixed(2)} €`,size:"small",sx:p?{bgcolor:r.accents.green,color:"black",fontWeight:"bold"}:i.chip.default}),p&&e.jsxs(C,{variant:"caption",sx:{color:r.accents.green,display:"flex",alignItems:"center",gap:.5},children:[e.jsx(ne,{fontSize:"inherit"})," Machbar"]})]})]}),e.jsx(V,{size:"small",onClick:()=>h(t.id),sx:{color:r.accents.red},children:e.jsx(X,{})})]})},t.id)})}),e.jsx($,{variant:"contained",size:"large",startIcon:e.jsx(Y,{}),onClick:()=>g(!0),sx:{position:"fixed",bottom:90,right:20,borderRadius:8,px:3,...i.buttonGradient},children:"Wunsch"}),e.jsxs(oe,{open:b,onClose:()=>g(!1),PaperProps:i.dialog.paper,fullWidth:!0,children:[e.jsx(le,{sx:i.dialog.title.sx,children:"Neuer Wunsch"}),e.jsx(ce,{sx:i.dialog.content.sx,children:e.jsxs(A,{spacing:2,sx:{mt:1},children:[e.jsx(E,{label:"Name",fullWidth:!0,autoFocus:!0,value:a.name,onChange:t=>m({...a,name:t.target.value}),sx:i.inputField}),e.jsx(E,{label:"Preis",type:"number",fullWidth:!0,InputProps:{startAdornment:e.jsx(ge,{position:"start",children:"€"})},value:a.price,onChange:t=>m({...a,price:t.target.value}),sx:i.inputField}),e.jsxs(E,{select:!0,label:"Priorität",fullWidth:!0,SelectProps:{native:!0},value:a.priority,onChange:t=>m({...a,priority:t.target.value}),sx:i.inputField,children:[e.jsx("option",{value:"high",children:"Hoch"}),e.jsx("option",{value:"medium",children:"Mittel"}),e.jsx("option",{value:"low",children:"Niedrig"})]})]})}),e.jsxs(de,{sx:i.dialog.actions.sx,children:[e.jsx($,{onClick:()=>g(!1),color:"inherit",children:"Abbrechen"}),e.jsx($,{onClick:S,variant:"contained",disabled:!a.name,sx:i.buttonGradient,children:"Hinzufügen"})]})]})]})})}export{Se as default};
