import{m as me,n as fe,j as De,u as Ne,r as S,x as He,A as _e,z as Oe,y as $e,p as le,H as ue,o as ke}from"./index-CRicB7GR.js";var J={},qe=me;Object.defineProperty(J,"__esModule",{value:!0});var ze=J.default=void 0,Pe=qe(fe()),je=De;ze=J.default=(0,Pe.default)((0,je.jsx)("path",{d:"M9 1h6v2H9zm10.03 6.39 1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61M13 14h-2V8h2z"}),"Timer");const $=new Date("2025-12-15T00:00:00"),v=n=>typeof n=="number"?n.toFixed(1):"0.0",de=n=>typeof n=="number"?n.toFixed(2):"0.00",Te=n=>{if(!n||n<=0)return"0m";const l=Math.floor(n/60),c=Math.round(n%60);return l>0?`${l}h ${c}m`:`${c}m`},k=n=>Te(n*60),Ae=n=>{const l=new Date,c=new Date(l);c.setDate(l.getDate()-7);const r=n.filter(a=>{const t=a.startTime.toDate?a.startTime.toDate():new Date(a.startTime);return(a.endTime?a.endTime.toDate?a.endTime.toDate():new Date(a.endTime):new Date)>c&&t<l}).map(a=>{const t=a.startTime.toDate?a.startTime.toDate():new Date(a.startTime),o=a.endTime?a.endTime.toDate?a.endTime.toDate():new Date(a.endTime):new Date;return{start:Math.max(t.getTime(),c.getTime()),end:Math.min(o.getTime(),l.getTime())}}).filter(a=>a.end>a.start);if(r.length===0)return 0;r.sort((a,t)=>a.start-t.start);const h=[];let i=r[0];for(let a=1;a<r.length;a++)r[a].start<i.end?i.end=Math.max(i.end,r[a].end):(h.push(i),i=r[a]);h.push(i);const D=h.reduce((a,t)=>a+(t.end-t.start),0),d=7*24*60*60*1e3;return Math.min(100,D/d*100)},We=(n,l,c)=>l.some(s=>{const r=s.startTime.toDate?s.startTime.toDate():new Date(s.startTime),h=s.endTime?s.endTime.toDate?s.endTime.toDate():new Date(s.endTime):new Date;return n>=r&&n<=h?(s.itemIds||(s.itemId?[s.itemId]:[])).some(D=>{const d=c.find(t=>t.id===D);return d?(d.subCategory||"").toLowerCase().includes("strumpfhose"):!1}):!1}),Ge=(n,l,c)=>{const s=new Date(n);s.setHours(0,0,0,0);const r=new Date(n);r.setHours(23,59,59,999);const i=l.filter(t=>{const o=t.startTime.toDate?t.startTime.toDate():new Date(t.startTime),f=t.endTime?t.endTime.toDate?t.endTime.toDate():new Date(t.endTime):new Date;return o>r||f<s?!1:(t.itemIds||(t.itemId?[t.itemId]:[])).some(C=>{const x=c.find(q=>q.id===C);if(!x)return!1;const R=(x.mainCategory||"").toLowerCase(),I=(x.subCategory||"").toLowerCase();return R.includes("nylon")||I.includes("strumpfhose")||I.includes("stockings")})}).map(t=>{const o=t.startTime.toDate?t.startTime.toDate():new Date(t.startTime),f=t.endTime?t.endTime.toDate?t.endTime.toDate():new Date(t.endTime):new Date;return{start:Math.max(o.getTime(),s.getTime()),end:Math.min(f.getTime(),r.getTime())}}).filter(t=>t.end>t.start);if(i.length===0)return 0;i.sort((t,o)=>t.start-o.start);const D=[];let d=i[0];for(let t=1;t<i.length;t++)i[t].start<d.end?d.end=Math.max(d.end,i[t].end):(D.push(d),d=i[t]);D.push(d);const a=D.reduce((t,o)=>t+(o.end-o.start),0);return Math.floor(a/6e4)};function Je(n,l,c){const{currentUser:s}=Ne(),[r,h]=S.useState({totalReleases:0,cleanReleases:0,keptOn:0}),[i,D]=S.useState([]),[d,a]=S.useState({health:{orphanCount:0},financials:{avgCPW:"0.00"},usage:{nylonIndex:"0.0"},spermaScore:{rate:"0.0",total:0,count:0},coreMetrics:{nylonEnclosure:"0.0",nocturnal:"0.0",nylonGap:"0m",cpnh:"0.00",complianceLag:"0m",coverage:"0.0",resistance:"0.0",voluntarism:"0.0%",endurance:"0m",enduranceNylon:"0m",enduranceDessous:"0m",submission:"85.0",denial:"12.0",chastity:"0.0"},femIndex:{score:0,trend:"neutral"},basics:{activeItems:0,washing:0,wornToday:0,archived:0}});return S.useEffect(()=>{if(s&&c===void 0){const t=He($e(le,`users/${s.uid}/sessions`),Oe("startTime",">=",$),_e("startTime","desc")),o=ue(t,f=>{const g=f.docs.map(C=>({id:C.id,...C.data()}));D(g)});return()=>o()}},[s,c]),S.useEffect(()=>{if(!s)return;const t=ke(le,`users/${s.uid}/stats/releaseStats`),o=ue(t,f=>{if(f.exists()){const g=f.data();h({totalReleases:Number(g.totalReleases)||0,cleanReleases:Number(g.cleanReleases)||0,keptOn:Number(g.keptOn)||0})}});return()=>o()},[s]),S.useEffect(()=>{if(!Array.isArray(n))return;let t=[];c!==void 0?t=c:i.length>0?t=i:t=l||[];const o=t.filter(e=>(e.startTime.toDate?e.startTime.toDate():new Date(e.startTime))>=$),f=n.filter(e=>e.status==="active"),g=n.filter(e=>e.status==="washing"),C=n.filter(e=>e.status==="archived"),x=n.filter(e=>e.status==="active"&&(!e.wearCount||e.wearCount===0)).length;let R=0,I=0;n.forEach(e=>{R+=parseFloat(e.cost)||0,I+=parseInt(e.wearCount)||0});const q=I>0?R/I:0,X=n.filter(e=>e.status!=="archived"&&(e.mainCategory&&e.mainCategory==="Nylons"||e.subCategory&&e.subCategory.toLowerCase().includes("strumpfhose"))),E=new Date,V=new Date;V.setDate(E.getDate()-30);const he=t.filter(e=>(e.endTime?e.endTime.toDate?e.endTime.toDate():new Date(e.endTime):new Date)>=V);let Z=0;const z=new Set;he.forEach(e=>{const u=e.itemIds||(e.itemId?[e.itemId]:[]);let M=!1;if(u.forEach(m=>{const b=n.find(_=>_.id===m);if(!b)return;const w=b.mainCategory||"",y=(b.subCategory||"").toLowerCase();(w==="Nylons"||y.includes("strumpfhose")||y.includes("stockings"))&&(M=!0,z.add(m))}),M){const m=e.startTime.toDate?e.startTime.toDate():new Date(e.startTime),b=e.endTime?e.endTime.toDate?e.endTime.toDate():new Date(e.endTime):new Date,w=m<V?V:m,y=b;y>w&&(Z+=(y-w)/6e4)}});const ee=z.size>0?Z/z.size/60:0,ge=X.reduce((e,u)=>e+(Number(u.totalMinutes)||0),0),we=X.reduce((e,u)=>e+(Number(u.cost)||0),0),te=ge/60,ye=te>0?we/te:0,pe=Ae(t);let P=0,ne=0;const L=new Date($);for(;L<=E;){P++;const e=new Date(L);e.setHours(2,0,0,0),e<=E&&We(e,t,n)&&ne++,L.setDate(L.getDate()+1)}const ae=P>0?ne/P*100:0;let se=0,j=0;const N=new Date($);for(;N<=E;){j++;const e=Ge(N,t,n);se+=(1440-e)/60,N.setDate(N.getDate()+1)}const ve=j>0?se/j:24;let A=0,oe=0,re=0,W=0;o.forEach(e=>{const u=e.startTime.toDate?e.startTime.toDate():new Date(e.startTime),M=e.endTime?e.endTime.toDate?e.endTime.toDate():new Date(e.endTime):new Date,m=Math.max(0,M.getTime()-u.getTime());A+=m,e.type==="voluntary"&&(oe+=m),typeof e.complianceLagMinutes=="number"&&(re+=e.complianceLagMinutes,W++)});const Ce=A>0?oe/A*100:0,Ie=o.length>0?o.filter(e=>e.type==="punishment").length/o.length*100:0,Me=W>0?re/W:0,be=o.filter(e=>e.startTime);let H=0,G=0,F=0,K=0,ie=0,B=0;be.forEach(e=>{const u=e.startTime.toDate?e.startTime.toDate():new Date(e.startTime),M=e.endTime?e.endTime.toDate?e.endTime.toDate():new Date(e.endTime):new Date,m=Math.max(0,(M-u)/36e5),w=(e.itemIds||(e.itemId?[e.itemId]:[])).map(T=>n.find(p=>p.id===T)).filter(T=>T);if(w.length===0)return;const y=w.some(T=>{const p=(T.subCategory||"").toLowerCase();return(T.mainCategory||"").toLowerCase().includes("nylon")||p.includes("strumpfhose")||p.includes("stockings")}),_=w.some(T=>{const p=(T.subCategory||"").toLowerCase(),O=(T.mainCategory||"").toLowerCase();return O.includes("dessous")||O.includes("wÃ¤sche")||p.includes("body")||p.includes("slip")||p.includes("bh")||O.includes("corsage")});(y||_)&&(H+=m,G++),y&&(F+=m,K++),_&&(ie+=m,B++)});const Se=G>0?H/G:0,xe=K>0?F/K:0,Re=B>0?ie/B:0,U=H>0?F/H*100:0,Ee=r.totalReleases>0?r.cleanReleases/r.totalReleases*100:0,Ve=Math.round(U*.3+ae*.2+ee*2),ce=new Date;ce.setHours(0,0,0,0);const Le=t.filter(e=>e.startTime?(e.startTime.toDate?e.startTime.toDate():new Date(e.startTime))>=ce:!1),Y=new Set;Le.forEach(e=>{e.itemId&&Y.add(e.itemId),e.itemIds&&e.itemIds.forEach(u=>Y.add(u))}),a({health:{orphanCount:x},financials:{avgCPW:de(q)},usage:{nylonIndex:v(ee)},spermaScore:{rate:v(Ee),total:r.totalReleases,count:r.cleanReleases},coreMetrics:{nylonEnclosure:v(U),nocturnal:v(ae),nylonGap:k(ve),cpnh:de(ye),complianceLag:Te(Me),coverage:v(pe),resistance:v(Ie),voluntarism:v(Ce)+"%",endurance:k(Se),enduranceNylon:k(xe),enduranceDessous:k(Re),submission:"85.0",denial:"12.0",chastity:v(U)},femIndex:{score:Math.min(100,Ve),trend:"stable"},basics:{activeItems:f.length,washing:g.length,wornToday:Y.size,archived:C.length}})},[n,l,c,i,r]),d}var Q={},Fe=me;Object.defineProperty(Q,"__esModule",{value:!0});var Ke=Q.default=void 0,Be=Fe(fe()),Ue=De;Ke=Q.default=(0,Be.default)((0,Ue.jsx)("path",{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11z"}),"Security");export{ze as a,Ke as d,Je as u};
