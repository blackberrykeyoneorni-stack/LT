import{x as y,A as f,z as m,y as p,p as s,E as S,v as u,o as c,bk as l,F as M}from"./index-CaoVXdRw.js";const h={time:{dayStartHour:7,dayStartMinute:30,nightStartHour:23,nightStartMinute:0,weekendExtensionMinutes:0},tzd:{triggerChance:.08,tzdMaxHours:36,lockInventory:!0,zoneWeights:[.2,.5,.3]},purity:{cleanChance:.6,allowBegging:!0,beggingSuccessChance:.5},instruction:{forcedReleaseTriggerChance:.15,forcedReleaseMethods:{hand:.34,toy_vaginal:.33,toy_anal:.33}},punishment:{defaultDurationMinutes:60,refusalMultiplier:1.5,showTimer:!0}},r="suspensions",z=async(e,a)=>{const o=new Date(a.startDate),t=new Date;if(t.setHours(23,59,59,999),o<=t)throw new Error("Unzulässig: Aussetzungen müssen mindestens für den Folgetag geplant werden.");await M(p(s,`users/${e}/${r}`),{type:a.type,reason:a.reason,startDate:l.fromDate(new Date(a.startDate)),endDate:l.fromDate(new Date(a.endDate)),createdAt:l.now(),status:"scheduled"})},A=async e=>{const a=y(p(s,`users/${e}/${r}`),m("status","in",["scheduled","active"]),f("startDate","asc"));return(await S(a)).docs.map(t=>({id:t.id,...t.data(),startDate:t.data().startDate.toDate(),endDate:t.data().endDate.toDate()}))},b=async e=>{try{const a=y(p(s,`users/${e}/${r}`),f("startDate","desc"));return(await S(a)).docs.map(t=>{var d,w;return{id:t.id,...t.data(),startDate:(d=t.data().startDate)!=null&&d.toDate?t.data().startDate.toDate():new Date(t.data().startDate),endDate:(w=t.data().endDate)!=null&&w.toDate?t.data().endDate.toDate():new Date(t.data().endDate)}})}catch(a){return console.error("Error loading history:",a),[]}},q=async e=>{const a=new Date,o=(h==null?void 0:h.time)||{dayStartHour:7,dayStartMinute:30,nightStartHour:23,nightStartMinute:0},t=y(p(s,`users/${e}/${r}`),m("status","==","active")),d=await S(t);if(!d.empty){const i=d.docs[0],n=i.data(),D=n.endDate.toDate(),g=new Date(D);return g.setHours(o.nightStartHour,o.nightStartMinute,0,0),g<a?(await u(c(s,`users/${e}/${r}`,i.id),{status:"completed"}),await u(c(s,`users/${e}/status/dailyInstruction`),{activeSuspension:!1,suspensionReason:null}),null):{id:i.id,...n,startDate:n.startDate.toDate(),endDate:D}}const w=y(p(s,`users/${e}/${r}`),m("status","==","scheduled")),v=await S(w);for(const i of v.docs){const n=i.data(),D=n.startDate.toDate(),g=n.endDate.toDate(),$=new Date(D);if($.setHours(o.dayStartHour,o.dayStartMinute,0,0),$<=a)return await u(c(s,`users/${e}/${r}`,i.id),{status:"active"}),await u(c(s,`users/${e}/status/tzd`),{isActive:!1,result:"terminated_by_suspension",endTime:l.now()}),await u(c(s,`users/${e}/status/dailyInstruction`),{evasionPenaltyTriggered:!1,tzdDurationMinutes:0,activeSuspension:!0,suspensionReason:n.reason}),console.log(`Suspension activated. TZD terminated. Reason: ${n.reason}`),{id:i.id,...n,status:"active",startDate:D,endDate:g}}return null},C=async(e,a)=>{await u(c(s,`users/${e}/${r}`,a),{status:"terminated",terminatedAt:l.now()}),await u(c(s,`users/${e}/status/dailyInstruction`),{activeSuspension:!1,suspensionReason:null})};export{h as D,A as a,z as b,q as c,b as g,C as t};
