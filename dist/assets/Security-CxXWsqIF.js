import{p as ee,q as te,j as ne,u as we,r as E,t as ve,v as Ie,K as Ce}from"./index-B-V4gYfI.js";var z={},be=ee;Object.defineProperty(z,"__esModule",{value:!0});var Me=z.default=void 0,xe=be(te()),Re=ne;Me=z.default=(0,xe.default)((0,Re.jsx)("path",{d:"M9 1h6v2H9zm10.03 6.39 1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61M13 14h-2V8h2z"}),"Timer");const q=new Date("2025-12-15T00:00:00"),Se=(n,y,f)=>y.some(s=>{const i=s.startTime.toDate?s.startTime.toDate():new Date(s.startTime),M=s.endTime?s.endTime.toDate?s.endTime.toDate():new Date(s.endTime):new Date;return n>=i&&n<=M?(s.itemIds||(s.itemId?[s.itemId]:[])).some(g=>{const a=f.find(t=>t.id===g);return a?(a.subCategory||"").toLowerCase().includes("strumpfhose"):!1}):!1}),Ne=(n,y,f)=>{const s=new Date(n);s.setHours(0,0,0,0);const i=new Date(n);i.setHours(23,59,59,999);const u=y.filter(t=>{const o=t.startTime.toDate?t.startTime.toDate():new Date(t.startTime),C=t.endTime?t.endTime.toDate?t.endTime.toDate():new Date(t.endTime):new Date;return o>i||C<s?!1:(t.itemIds||(t.itemId?[t.itemId]:[])).some(x=>{const T=f.find(p=>p.id===x);if(!T)return!1;const L=(T.mainCategory||"").toLowerCase(),h=(T.subCategory||"").toLowerCase();return L.includes("nylon")||h.includes("strumpfhose")||h.includes("stockings")})}).map(t=>{const o=t.startTime.toDate?t.startTime.toDate():new Date(t.startTime),C=t.endTime?t.endTime.toDate?t.endTime.toDate():new Date(t.endTime):new Date;return{start:Math.max(o.getTime(),s.getTime()),end:Math.min(C.getTime(),i.getTime())}}).filter(t=>t.end>t.start);if(u.length===0)return 0;u.sort((t,o)=>t.start-o.start);const g=[];let a=u[0];for(let t=1;t<u.length;t++)u[t].start<a.end?a.end=Math.max(a.end,u[t].end):(g.push(a),a=u[t]);g.push(a);const c=g.reduce((t,o)=>t+(o.end-o.start),0);return Math.floor(c/6e4)};function je(n,y,f=[]){const{currentUser:s}=we(),[i,M]=E.useState({totalReleases:0,cleanReleases:0,keptOn:0}),[u,g]=E.useState({health:{orphanCount:0},financials:{avgCPW:0},usage:{nylonIndex:0},spermaScore:{rate:0,total:0,count:0},coreMetrics:{enclosure:0,nocturnal:0,nylonGap:0,cpnh:0,complianceLag:0,exposure:0,resistance:0,voluntarism:0,endurance:0,enduranceNylon:0,enduranceDessous:0,submission:85,denial:12,chastity:0},femIndex:{score:0,trend:"neutral"},basics:{activeItems:0,washing:0,wornToday:0,archived:0}});return E.useEffect(()=>{if(!s)return;const a=ve(Ie,`users/${s.uid}/stats/releaseStats`),c=Ce(a,t=>{if(t.exists()){const o=t.data();M({totalReleases:Number(o.totalReleases)||0,cleanReleases:Number(o.cleanReleases)||0,keptOn:Number(o.keptOn)||0})}});return()=>c()},[s]),E.useEffect(()=>{if(!Array.isArray(n))return;const a=f&&f.length>0?f:y||[],c=a.filter(e=>(e.startTime.toDate?e.startTime.toDate():new Date(e.startTime))>=q),t=n.filter(e=>e.status==="active"),o=n.filter(e=>e.status==="washing"),C=n.filter(e=>e.status==="archived"),V=n.filter(e=>e.status==="active"&&(!e.wearCount||e.wearCount===0)).length;let x=0,T=0;n.forEach(e=>{x+=parseFloat(e.cost)||0,T+=parseInt(e.wearCount)||0});const L=T>0?x/T:0,h=n.filter(e=>e.status!=="archived"&&(e.mainCategory&&e.mainCategory==="Nylons"||e.subCategory&&e.subCategory.toLowerCase().includes("strumpfhose"))),p=new Date,R=new Date;R.setDate(p.getDate()-30);const se=a.filter(e=>(e.endTime?e.endTime.toDate?e.endTime.toDate():new Date(e.endTime):new Date)>=R);let $=0;se.forEach(e=>{if((e.itemIds||(e.itemId?[e.itemId]:[])).some(D=>{const w=n.find(b=>b.id===D);if(!w)return!1;const m=w.mainCategory||"",v=(w.subCategory||"").toLowerCase();return m==="Nylons"||v.includes("strumpfhose")})){const D=e.startTime.toDate?e.startTime.toDate():new Date(e.startTime),w=e.endTime?e.endTime.toDate?e.endTime.toDate():new Date(e.endTime):new Date,m=D<R?R:D,v=w;if(v>m){const b=v-m;$+=b/6e4}}});const G=h.length>0?$/h.length/60:0,ae=h.reduce((e,r)=>e+(Number(r.totalMinutes)||0),0),oe=h.reduce((e,r)=>e+(Number(r.cost)||0),0),K=ae/60,re=K>0?parseFloat((oe/K).toFixed(2)):0,W=t.length+o.length+n.filter(e=>e.status==="wearing").length,_=W>0?Math.round(h.length/W*100):0;let F=0,U=0;const S=new Date(q);for(;S<=p;){F++;const e=new Date(S);e.setHours(2,0,0,0),e<=p&&Se(e,a,n)&&U++,S.setDate(S.getDate()+1)}const Y=F>0?Math.round(U/F*100):0;let B=0,H=0;const N=new Date(q);for(;N<=p;){H++;const r=1440-Ne(N,a,n);B+=r/60,N.setDate(N.getDate()+1)}const ie=H>0?B/H:24,ce=c.filter(e=>e.type==="voluntary").length,le=c.length>0?Math.round(ce/c.length*100):0,ue=c.filter(e=>e.type==="punishment"),de=c.length>0?Math.round(ue.length/c.length*100):0,me=c.filter(e=>e.endTime&&e.startTime);let J=0,O=0,Q=0,A=0,X=0,j=0;me.forEach(e=>{const r=e.startTime.toDate?e.startTime.toDate():new Date(e.startTime),D=((e.endTime.toDate?e.endTime.toDate():new Date(e.endTime))-r)/36e5,m=(e.itemIds||(e.itemId?[e.itemId]:[])).map(l=>n.find(d=>d.id===l)).filter(l=>l);if(m.length===0)return;const v=m.some(l=>{const d=(l.mainCategory||"").toLowerCase(),I=(l.subCategory||"").toLowerCase();return d.includes("nylon")||I.includes("strumpfhose")||I.includes("stockings")}),b=m.some(l=>{const d=(l.mainCategory||"").toLowerCase(),I=(l.subCategory||"").toLowerCase();return d.includes("dessous")||d.includes("wÃ¤sche")||d.includes("corsage")||I.includes("body")||I.includes("bh")||I.includes("slip")});m.every(l=>{const d=(l.mainCategory||"").toLowerCase();return d==="accessoires"||d==="schuhe"})||(J+=D,O++),v&&(Q+=D,A++),b&&(X+=D,j++)});const fe=O>0?parseFloat((J/O).toFixed(1)):0,he=A>0?parseFloat((Q/A).toFixed(1)):0,De=j>0?parseFloat((X/j).toFixed(1)):0,ge={rate:i.totalReleases>0?Math.round(i.cleanReleases/i.totalReleases*100):0,total:i.totalReleases,count:i.cleanReleases},Te=Math.round(_*.3+Y*.2+G*2),Z=new Date;Z.setHours(0,0,0,0);const ye=a.filter(e=>e.startTime?(e.startTime.toDate?e.startTime.toDate():new Date(e.startTime))>=Z:!1),k=new Set;ye.forEach(e=>{e.itemId&&k.add(e.itemId),e.itemIds&&e.itemIds.forEach(r=>k.add(r))}),g({health:{orphanCount:V},financials:{avgCPW:L},usage:{nylonIndex:parseFloat(G.toFixed(1))},spermaScore:ge,coreMetrics:{enclosure:_,nocturnal:Y,nylonGap:parseFloat(ie.toFixed(1)),cpnh:re,complianceLag:12,exposure:45,resistance:de,voluntarism:le,endurance:fe,enduranceNylon:he,enduranceDessous:De,submission:85,denial:12,chastity:_},femIndex:{score:Math.min(100,Te),trend:"stable"},basics:{activeItems:t.length,washing:o.length,wornToday:k.size,archived:C.length}})},[n,y,f,i]),u}var P={},Ee=ee;Object.defineProperty(P,"__esModule",{value:!0});var Le=P.default=void 0,_e=Ee(te()),Fe=ne;Le=P.default=(0,_e.default)((0,Fe.jsx)("path",{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11z"}),"Security");export{Me as a,Le as d,je as u};
