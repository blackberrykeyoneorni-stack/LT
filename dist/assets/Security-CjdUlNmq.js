import{p as ie,q as ce,j as le,u as xe,r as I,A as Re,G as Se,F as Ne,E as Ee,v as oe,K as re,t as Fe}from"./index-NmxHiSj_.js";var W={},Le=ie;Object.defineProperty(W,"__esModule",{value:!0});var _e=W.default=void 0,He=Le(ce()),Oe=le;_e=W.default=(0,He.default)((0,Oe.jsx)("path",{d:"M9 1h6v2H9zm10.03 6.39 1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61M13 14h-2V8h2z"}),"Timer");const _=new Date("2025-12-15T00:00:00"),qe=(a,y,m)=>y.some(s=>{const r=s.startTime.toDate?s.startTime.toDate():new Date(s.startTime),M=s.endTime?s.endTime.toDate?s.endTime.toDate():new Date(s.endTime):new Date;return a>=r&&a<=M?(s.itemIds||(s.itemId?[s.itemId]:[])).some(g=>{const c=m.find(t=>t.id===g);return c?(c.subCategory||"").toLowerCase().includes("strumpfhose"):!1}):!1}),Ae=(a,y,m)=>{const s=new Date(a);s.setHours(0,0,0,0);const r=new Date(a);r.setHours(23,59,59,999);const i=y.filter(t=>{const n=t.startTime.toDate?t.startTime.toDate():new Date(t.startTime),l=t.endTime?t.endTime.toDate?t.endTime.toDate():new Date(t.endTime):new Date;return n>r||l<s?!1:(t.itemIds||(t.itemId?[t.itemId]:[])).some(p=>{const b=m.find(H=>H.id===p);if(!b)return!1;const R=(b.mainCategory||"").toLowerCase(),w=(b.subCategory||"").toLowerCase();return R.includes("nylon")||w.includes("strumpfhose")||w.includes("stockings")})}).map(t=>{const n=t.startTime.toDate?t.startTime.toDate():new Date(t.startTime),l=t.endTime?t.endTime.toDate?t.endTime.toDate():new Date(t.endTime):new Date;return{start:Math.max(n.getTime(),s.getTime()),end:Math.min(l.getTime(),r.getTime())}}).filter(t=>t.end>t.start);if(i.length===0)return 0;i.sort((t,n)=>t.start-n.start);const g=[];let c=i[0];for(let t=1;t<i.length;t++)i[t].start<c.end?c.end=Math.max(c.end,i[t].end):(g.push(c),c=i[t]);g.push(c);const x=g.reduce((t,n)=>t+(n.end-n.start),0);return Math.floor(x/6e4)};function Ve(a,y,m){const{currentUser:s}=xe(),[r,M]=I.useState({totalReleases:0,cleanReleases:0,keptOn:0}),[i,g]=I.useState([]),[c,x]=I.useState({health:{orphanCount:0},financials:{avgCPW:0},usage:{nylonIndex:0},spermaScore:{rate:0,total:0,count:0},coreMetrics:{enclosure:0,nocturnal:0,nylonGap:0,cpnh:0,complianceLag:0,exposure:0,resistance:0,voluntarism:0,endurance:0,enduranceNylon:0,enduranceDessous:0,submission:85,denial:12,chastity:0},femIndex:{score:0,trend:"neutral"},basics:{activeItems:0,washing:0,wornToday:0,archived:0}});return I.useEffect(()=>{if(s&&m===void 0){const t=Re(Ee(oe,`users/${s.uid}/sessions`),Ne("startTime",">=",_),Se("startTime","desc")),n=re(t,l=>{const f=l.docs.map(p=>({id:p.id,...p.data()}));g(f)});return()=>n()}},[s,m]),I.useEffect(()=>{if(!s)return;const t=Fe(oe,`users/${s.uid}/stats/releaseStats`),n=re(t,l=>{if(l.exists()){const f=l.data();M({totalReleases:Number(f.totalReleases)||0,cleanReleases:Number(f.cleanReleases)||0,keptOn:Number(f.keptOn)||0})}});return()=>n()},[s]),I.useEffect(()=>{if(!Array.isArray(a))return;let t=[];m!==void 0?t=m:i.length>0?t=i:t=y||[];const n=t.filter(e=>(e.startTime.toDate?e.startTime.toDate():new Date(e.startTime))>=_),l=a.filter(e=>e.status==="active"),f=a.filter(e=>e.status==="washing"),p=a.filter(e=>e.status==="archived"),b=a.filter(e=>e.status==="active"&&(!e.wearCount||e.wearCount===0)).length;let R=0,w=0;a.forEach(e=>{R+=parseFloat(e.cost)||0,w+=parseInt(e.wearCount)||0});const H=w>0?R/w:0,O=a.filter(e=>e.status!=="archived"&&(e.mainCategory&&e.mainCategory==="Nylons"||e.subCategory&&e.subCategory.toLowerCase().includes("strumpfhose"))),S=new Date,N=new Date;N.setDate(S.getDate()-30);const ue=t.filter(e=>(e.endTime?e.endTime.toDate?e.endTime.toDate():new Date(e.endTime):new Date)>=N);let B=0;const q=new Set;ue.forEach(e=>{const o=e.itemIds||(e.itemId?[e.itemId]:[]);let V=!1;if(o.forEach(h=>{const v=a.find(ae=>ae.id===h);if(!v)return;const D=v.mainCategory||"",T=(v.subCategory||"").toLowerCase();(D==="Nylons"||T.includes("strumpfhose")||T.includes("stockings"))&&(V=!0,q.add(h))}),V){const h=e.startTime.toDate?e.startTime.toDate():new Date(e.startTime),v=e.endTime?e.endTime.toDate?e.endTime.toDate():new Date(e.endTime):new Date,D=h<N?N:h,T=v;if(T>D){const L=T-D;B+=L/6e4}}});const U=q.size>0?B/q.size/60:0,de=O.reduce((e,o)=>e+(Number(o.totalMinutes)||0),0),me=O.reduce((e,o)=>e+(Number(o.cost)||0),0),Y=de/60,fe=Y>0?parseFloat((me/Y).toFixed(2)):0,J=l.length+f.length+a.filter(e=>e.status==="wearing").length,A=J>0?Math.round(O.length/J*100):0;let k=0,Q=0;const E=new Date(_);for(;E<=S;){k++;const e=new Date(E);e.setHours(2,0,0,0),e<=S&&qe(e,t,a)&&Q++,E.setDate(E.getDate()+1)}const X=k>0?Math.round(Q/k*100):0;let Z=0,j=0;const F=new Date(_);for(;F<=S;){j++;const o=1440-Ae(F,t,a);Z+=o/60,F.setDate(F.getDate()+1)}const he=j>0?Z/j:24,De=n.filter(e=>e.type==="voluntary").length,ge=n.length>0?Math.round(De/n.length*100):0,Te=n.filter(e=>e.type==="punishment"),ye=n.length>0?Math.round(Te.length/n.length*100):0,pe=n.filter(e=>e.endTime&&e.startTime);let ee=0,z=0,te=0,$=0,se=0,G=0;pe.forEach(e=>{const o=e.startTime.toDate?e.startTime.toDate():new Date(e.startTime),h=((e.endTime.toDate?e.endTime.toDate():new Date(e.endTime))-o)/36e5,D=(e.itemIds||(e.itemId?[e.itemId]:[])).map(u=>a.find(d=>d.id===u)).filter(u=>u);if(D.length===0)return;const T=D.some(u=>{const d=(u.mainCategory||"").toLowerCase(),C=(u.subCategory||"").toLowerCase();return d.includes("nylon")||C.includes("strumpfhose")||C.includes("stockings")}),L=D.some(u=>{const d=(u.mainCategory||"").toLowerCase(),C=(u.subCategory||"").toLowerCase();return d.includes("dessous")||d.includes("wÃ¤sche")||d.includes("corsage")||C.includes("body")||C.includes("bh")||C.includes("slip")});D.every(u=>{const d=(u.mainCategory||"").toLowerCase();return d==="accessoires"||d==="schuhe"})||(ee+=h,z++),T&&(te+=h,$++),L&&(se+=h,G++)});const we=z>0?parseFloat((ee/z).toFixed(1)):0,ve=$>0?parseFloat((te/$).toFixed(1)):0,Ce=G>0?parseFloat((se/G).toFixed(1)):0,Ie={rate:r.totalReleases>0?Math.round(r.cleanReleases/r.totalReleases*100):0,total:r.totalReleases,count:r.cleanReleases},be=Math.round(A*.3+X*.2+U*2),ne=new Date;ne.setHours(0,0,0,0);const Me=t.filter(e=>e.startTime?(e.startTime.toDate?e.startTime.toDate():new Date(e.startTime))>=ne:!1),P=new Set;Me.forEach(e=>{e.itemId&&P.add(e.itemId),e.itemIds&&e.itemIds.forEach(o=>P.add(o))}),x({health:{orphanCount:b},financials:{avgCPW:H},usage:{nylonIndex:parseFloat(U.toFixed(1))},spermaScore:Ie,coreMetrics:{enclosure:A,nocturnal:X,nylonGap:parseFloat(he.toFixed(1)),cpnh:fe,complianceLag:12,exposure:45,resistance:ye,voluntarism:ge,endurance:we,enduranceNylon:ve,enduranceDessous:Ce,submission:85,denial:12,chastity:A},femIndex:{score:Math.min(100,be),trend:"stable"},basics:{activeItems:l.length,washing:f.length,wornToday:P.size,archived:p.length}})},[a,y,m,i,r]),c}var K={},ke=ie;Object.defineProperty(K,"__esModule",{value:!0});var je=K.default=void 0,ze=ke(ce()),$e=le;je=K.default=(0,ze.default)((0,$e.jsx)("path",{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11z"}),"Security");export{_e as a,je as d,Ve as u};
