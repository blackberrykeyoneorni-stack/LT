import{p as R,q as I,j as T,ad as $,t as u,E as j,v as o,z as D,w as S}from"./index-xjOfLG89.js";var w={},b=R;Object.defineProperty(w,"__esModule",{value:!0});var A=w.default=void 0,E=b(I()),_=T;A=w.default=(0,E.default)([(0,_.jsx)("path",{d:"M12 5.99 19.53 19H4.47zM12 2 1 21h22z"},"0"),(0,_.jsx)("path",{d:"M13 16h-2v2h2zm0-6h-2v5h2z"},"1")],"WarningAmber");var y={},z=R;Object.defineProperty(y,"__esModule",{value:!0});var N=y.default=void 0,q=z(I()),P=T;N=y.default=(0,q.default)((0,P.jsx)("path",{d:"M12 2c-5.33 4.55-8 8.48-8 11.8 0 4.98 3.8 8.2 8 8.2s8-3.22 8-8.2c0-3.32-2.67-7.25-8-11.8M7.83 14c.37 0 .67.26.74.62.41 2.22 2.28 2.98 3.64 2.87.43-.02.79.32.79.75 0 .4-.32.73-.72.75-2.13.13-4.62-1.09-5.19-4.12-.08-.45.28-.87.74-.87"}),"WaterDrop");const O=async(s,d)=>{const{items:r,itemId:m,type:f="voluntary",periodId:e,acceptedAt:c,note:l="",verifiedViaNfc:v=!1}=d;if(!s)throw new Error("User ID fehlt.");const p=$(o);let h=0;if(f==="instruction"&&c){const t=new Date(c);if(!isNaN(t.getTime())){const g=Date.now()-t.getTime();h=Math.max(0,Math.floor(g/6e4))}}let i=[];if(r&&Array.isArray(r)&&r.length>0?i=r:m&&(i=[{id:m}]),i.length===0)return;const n=i.map(t=>t.id);i.forEach(t=>{const g=u(j(o,`users/${s}/sessions`)),a={itemId:t.id,type:f,startTime:D(),endTime:null,note:l};f==="instruction"&&(a.itemIds=n,a.period=e,a.complianceLagMinutes=h),v&&(a.verifiedViaNfc=!0),p.set(g,a),p.update(u(o,`users/${s}/items`,t.id),{status:"wearing"})}),await p.commit()},C=async(s,d,r={})=>{if(!s||!d)throw new Error("Parameter fehlen.");const m=u(o,`users/${s}/sessions`,d),f=await S(m);if(!f.exists()){console.error("Session nicht gefunden:",d);return}const e=f.data(),c=$(o);let l=null;const v=e.type==="instruction",p=e.period&&e.period.toLowerCase().includes("night");if(v&&!p){l=!1;const n=new Date,t=n.getTimezoneOffset()*6e4,g=new Date(n.getTime()-t).toISOString().split("T")[0];try{const a=u(o,`users/${s}/status/nightCompliance`),x=await S(a);if(x.exists()){const M=x.data();M.date===g&&(l=M.success)}}catch(a){console.error(a)}}const h={endTime:D(),feelings:r.feelings||[],finalNote:r.note||""};l!==null&&(h.nightSuccess=l),c.update(m,h);const i={status:"active",lastWorn:D()};if(e.itemIds&&Array.isArray(e.itemIds)&&e.itemIds.length>0)e.itemIds.forEach(n=>{const t=u(o,`users/${s}/items`,n);c.update(t,i)});else if(e.itemId){const n=u(o,`users/${s}/items`,e.itemId);c.update(n,i)}await c.commit()};export{A as a,C as b,N as d,O as s};
