import{m as we,n as pe,j as ve,u as Oe,r as S,x as $e,A as ke,z as qe,y as ze,p as he,H as ge,o as je}from"./index-CzcEts2D.js";var J={},Ae=we;Object.defineProperty(J,"__esModule",{value:!0});var We=J.default=void 0,Ge=Ae(pe()),Fe=ve;We=J.default=(0,Ge.default)((0,Fe.jsx)("path",{d:"M9 1h6v2H9zm10.03 6.39 1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61M13 14h-2V8h2z"}),"Timer");const O=new Date("2025-12-15T00:00:00"),v=n=>typeof n=="number"?n.toFixed(1):"0.0",ye=n=>typeof n=="number"?n.toFixed(2):"0.00",Ce=n=>{if(!n||n<=0)return"0m";const l=Math.floor(n/60),c=Math.round(n%60);return l>0?`${l}h ${c}m`:`${c}m`},$=n=>Ce(n*60),Ke=n=>{const l=new Date,c=new Date(l);c.setDate(l.getDate()-7);const r=n.filter(a=>{const t=a.startTime.toDate?a.startTime.toDate():new Date(a.startTime);return(a.endTime?a.endTime.toDate?a.endTime.toDate():new Date(a.endTime):new Date)>c&&t<l}).map(a=>{const t=a.startTime.toDate?a.startTime.toDate():new Date(a.startTime),o=a.endTime?a.endTime.toDate?a.endTime.toDate():new Date(a.endTime):new Date;return{start:Math.max(t.getTime(),c.getTime()),end:Math.min(o.getTime(),l.getTime())}}).filter(a=>a.end>a.start);if(r.length===0)return 0;r.sort((a,t)=>a.start-t.start);const h=[];let i=r[0];for(let a=1;a<r.length;a++)r[a].start<i.end?i.end=Math.max(i.end,r[a].end):(h.push(i),i=r[a]);h.push(i);const D=h.reduce((a,t)=>a+(t.end-t.start),0),d=7*24*60*60*1e3;return Math.min(100,D/d*100)},Be=(n,l,c)=>l.some(s=>{const r=s.startTime.toDate?s.startTime.toDate():new Date(s.startTime),h=s.endTime?s.endTime.toDate?s.endTime.toDate():new Date(s.endTime):new Date;return n>=r&&n<=h?(s.itemIds||(s.itemId?[s.itemId]:[])).some(D=>{const d=c.find(t=>t.id===D);return d?(d.subCategory||"").toLowerCase().includes("strumpfhose"):!1}):!1}),Ue=(n,l,c)=>{const s=new Date(n);s.setHours(0,0,0,0);const r=new Date(n);r.setHours(23,59,59,999);const i=l.filter(t=>{const o=t.startTime.toDate?t.startTime.toDate():new Date(t.startTime),f=t.endTime?t.endTime.toDate?t.endTime.toDate():new Date(t.endTime):new Date;return o>r||f<s?!1:(t.itemIds||(t.itemId?[t.itemId]:[])).some(C=>{const x=c.find(k=>k.id===C);if(!x)return!1;const E=(x.mainCategory||"").toLowerCase(),I=(x.subCategory||"").toLowerCase();return E.includes("nylon")||I.includes("strumpfhose")||I.includes("stockings")})}).map(t=>{const o=t.startTime.toDate?t.startTime.toDate():new Date(t.startTime),f=t.endTime?t.endTime.toDate?t.endTime.toDate():new Date(t.endTime):new Date;return{start:Math.max(o.getTime(),s.getTime()),end:Math.min(f.getTime(),r.getTime())}}).filter(t=>t.end>t.start);if(i.length===0)return 0;i.sort((t,o)=>t.start-o.start);const D=[];let d=i[0];for(let t=1;t<i.length;t++)i[t].start<d.end?d.end=Math.max(d.end,i[t].end):(D.push(d),d=i[t]);D.push(d);const a=D.reduce((t,o)=>t+(o.end-o.start),0);return Math.floor(a/6e4)};function tt(n,l,c){const{currentUser:s}=Oe(),[r,h]=S.useState({totalReleases:0,cleanReleases:0,keptOn:0}),[i,D]=S.useState([]),[d,a]=S.useState({health:{orphanCount:0},financials:{avgCPW:"0.00"},usage:{nylonIndex:"0.0"},spermaScore:{rate:"0.0",total:0,count:0},coreMetrics:{nylonEnclosure:"0.0",nocturnal:"0.0",nylonGap:"0m",cpnh:"0.00",complianceLag:"0m",coverage:"0.0",resistance:"0.0",voluntarism:"0.0%",endurance:"0m",enduranceNylon:"0m",enduranceDessous:"0m",submission:"85.0",denial:"12.0",chastity:"0.0"},femIndex:{score:0,trend:"neutral",subScores:{physis:0,psyche:0,infiltration:0}},basics:{activeItems:0,washing:0,wornToday:0,archived:0}});return S.useEffect(()=>{if(s&&c===void 0){const t=$e(ze(he,`users/${s.uid}/sessions`),qe("startTime",">=",O),ke("startTime","desc")),o=ge(t,f=>{const g=f.docs.map(C=>({id:C.id,...C.data()}));D(g)});return()=>o()}},[s,c]),S.useEffect(()=>{if(!s)return;const t=je(he,`users/${s.uid}/stats/releaseStats`),o=ge(t,f=>{if(f.exists()){const g=f.data();h({totalReleases:Number(g.totalReleases)||0,cleanReleases:Number(g.cleanReleases)||0,keptOn:Number(g.keptOn)||0})}});return()=>o()},[s]),S.useEffect(()=>{if(!Array.isArray(n))return;let t=[];c!==void 0?t=c:i.length>0?t=i:t=l||[];const o=t.filter(e=>(e.startTime.toDate?e.startTime.toDate():new Date(e.startTime))>=O),f=n.filter(e=>e.status==="active"),g=n.filter(e=>e.status==="washing"),C=n.filter(e=>e.status==="archived"),x=n.filter(e=>e.status==="active"&&(!e.wearCount||e.wearCount===0)).length;let E=0,I=0;n.forEach(e=>{E+=parseFloat(e.cost)||0,I+=parseInt(e.wearCount)||0});const k=I>0?E/I:0,X=n.filter(e=>e.status!=="archived"&&(e.mainCategory&&e.mainCategory==="Nylons"||e.subCategory&&e.subCategory.toLowerCase().includes("strumpfhose"))),R=new Date,V=new Date;V.setDate(R.getDate()-30);const Ie=t.filter(e=>(e.endTime?e.endTime.toDate?e.endTime.toDate():new Date(e.endTime):new Date)>=V);let Z=0;const q=new Set;Ie.forEach(e=>{const u=e.itemIds||(e.itemId?[e.itemId]:[]);let M=!1;if(u.forEach(m=>{const b=n.find(_=>_.id===m);if(!b)return;const y=b.mainCategory||"",w=(b.subCategory||"").toLowerCase();(y==="Nylons"||w.includes("strumpfhose")||w.includes("stockings"))&&(M=!0,q.add(m))}),M){const m=e.startTime.toDate?e.startTime.toDate():new Date(e.startTime),b=e.endTime?e.endTime.toDate?e.endTime.toDate():new Date(e.endTime):new Date,y=m<V?V:m,w=b;w>y&&(Z+=(w-y)/6e4)}});const Me=q.size>0?Z/q.size/60:0,be=X.reduce((e,u)=>e+(Number(u.totalMinutes)||0),0),Se=X.reduce((e,u)=>e+(Number(u.cost)||0),0),ee=be/60,xe=ee>0?Se/ee:0,te=Ke(t);let z=0,ne=0;const L=new Date(O);for(;L<=R;){z++;const e=new Date(L);e.setHours(2,0,0,0),e<=R&&Be(e,t,n)&&ne++,L.setDate(L.getDate()+1)}const ae=z>0?ne/z*100:0;let se=0,j=0;const N=new Date(O);for(;N<=R;){j++;const e=Ue(N,t,n);se+=(1440-e)/60,N.setDate(N.getDate()+1)}const Ee=j>0?se/j:24;let A=0,oe=0,re=0,W=0;o.forEach(e=>{const u=e.startTime.toDate?e.startTime.toDate():new Date(e.startTime),M=e.endTime?e.endTime.toDate?e.endTime.toDate():new Date(e.endTime):new Date,m=Math.max(0,M.getTime()-u.getTime());A+=m,e.type==="voluntary"&&(oe+=m),typeof e.complianceLagMinutes=="number"&&(re+=e.complianceLagMinutes,W++)});const ie=A>0?oe/A*100:0,ce=o.length>0?o.filter(e=>e.type==="punishment").length/o.length*100:0,le=W>0?re/W:0,Re=o.filter(e=>e.startTime);let H=0,G=0,F=0,K=0,ue=0,B=0;Re.forEach(e=>{const u=e.startTime.toDate?e.startTime.toDate():new Date(e.startTime),M=e.endTime?e.endTime.toDate?e.endTime.toDate():new Date(e.endTime):new Date,m=Math.max(0,(M-u)/36e5),y=(e.itemIds||(e.itemId?[e.itemId]:[])).map(T=>n.find(p=>p.id===T)).filter(T=>T);if(y.length===0)return;const w=y.some(T=>{const p=(T.subCategory||"").toLowerCase();return(T.mainCategory||"").toLowerCase().includes("nylon")||p.includes("strumpfhose")||p.includes("stockings")}),_=y.some(T=>{const p=(T.subCategory||"").toLowerCase(),P=(T.mainCategory||"").toLowerCase();return P.includes("dessous")||P.includes("wÃ¤sche")||p.includes("body")||p.includes("slip")||p.includes("bh")||P.includes("corsage")});(w||_)&&(H+=m,G++),w&&(F+=m,K++),_&&(ue+=m,B++)});const de=G>0?H/G:0,Ve=K>0?F/K:0,Le=B>0?ue/B:0,U=H>0?F/H*100:0,Ne=r.totalReleases>0?r.cleanReleases/r.totalReleases*100:0,me=Math.min(100,de/12*100)*.4+U*.6,He=Math.max(0,100-le*1.6),fe=Math.max(0,ie*.6+He*.4-ce*2),De=ae*.5+te*.5,_e=Math.round(me*.3+fe*.3+De*.4),Te=new Date;Te.setHours(0,0,0,0);const Pe=t.filter(e=>e.startTime?(e.startTime.toDate?e.startTime.toDate():new Date(e.startTime))>=Te:!1),Y=new Set;Pe.forEach(e=>{e.itemId&&Y.add(e.itemId),e.itemIds&&e.itemIds.forEach(u=>Y.add(u))}),a({health:{orphanCount:x},financials:{avgCPW:ye(k)},usage:{nylonIndex:v(Me)},spermaScore:{rate:v(Ne),total:r.totalReleases,count:r.cleanReleases},coreMetrics:{nylonEnclosure:v(U),nocturnal:v(ae),nylonGap:$(Ee),cpnh:ye(xe),complianceLag:Ce(le),coverage:v(te),resistance:v(ce),voluntarism:v(ie)+"%",endurance:$(de),enduranceNylon:$(Ve),enduranceDessous:$(Le),submission:"85.0",denial:"12.0",chastity:v(U)},femIndex:{score:Math.min(100,_e),trend:"stable",subScores:{physis:Math.round(me),psyche:Math.round(fe),infiltration:Math.round(De)}},basics:{activeItems:f.length,washing:g.length,wornToday:Y.size,archived:C.length}})},[n,l,c,i,r]),d}var Q={},Ye=we;Object.defineProperty(Q,"__esModule",{value:!0});var Je=Q.default=void 0,Qe=Ye(pe()),Xe=ve;Je=Q.default=(0,Qe.default)((0,Xe.jsx)("path",{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11z"}),"Security");export{We as a,Je as d,tt as u};
