import{m as ge,n as ye,j as we,u as He,r as x,x as _e,A as Pe,z as $e,y as ke,p as De,H as he,o as qe}from"./index-BgyQ4a3x.js";var Y={},ze=ge;Object.defineProperty(Y,"__esModule",{value:!0});var Oe=Y.default=void 0,je=ze(ye()),Ae=we;Oe=Y.default=(0,je.default)((0,Ae.jsx)("path",{d:"M9 1h6v2H9zm10.03 6.39 1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42C16.07 4.74 14.12 4 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9 9-4.03 9-9c0-2.12-.74-4.07-1.97-5.61M13 14h-2V8h2z"}),"Timer");const $=new Date("2025-12-15T00:00:00"),v=n=>typeof n=="number"?n.toFixed(1):"0.0",Te=n=>typeof n=="number"?n.toFixed(2):"0.00",pe=n=>{if(!n||n<=0)return"0m";const l=Math.floor(n/60),c=Math.round(n%60);return l>0?`${l}h ${c}m`:`${c}m`},k=n=>pe(n*60),We=n=>{const l=new Date,c=new Date(l);c.setDate(l.getDate()-7);const r=n.filter(a=>{const t=a.startTime.toDate?a.startTime.toDate():new Date(a.startTime);return(a.endTime?a.endTime.toDate?a.endTime.toDate():new Date(a.endTime):new Date)>c&&t<l}).map(a=>{const t=a.startTime.toDate?a.startTime.toDate():new Date(a.startTime),o=a.endTime?a.endTime.toDate?a.endTime.toDate():new Date(a.endTime):new Date;return{start:Math.max(t.getTime(),c.getTime()),end:Math.min(o.getTime(),l.getTime())}}).filter(a=>a.end>a.start);if(r.length===0)return 0;r.sort((a,t)=>a.start-t.start);const T=[];let i=r[0];for(let a=1;a<r.length;a++)r[a].start<i.end?i.end=Math.max(i.end,r[a].end):(T.push(i),i=r[a]);T.push(i);const D=T.reduce((a,t)=>a+(t.end-t.start),0),u=7*24*60*60*1e3;return Math.min(100,D/u*100)},Ge=(n,l,c)=>l.some(s=>{const r=s.startTime.toDate?s.startTime.toDate():new Date(s.startTime),T=s.endTime?s.endTime.toDate?s.endTime.toDate():new Date(s.endTime):new Date;return n>=r&&n<=T?(s.itemIds||(s.itemId?[s.itemId]:[])).some(D=>{const u=c.find(t=>t.id===D);return u?(u.subCategory||"").toLowerCase().includes("strumpfhose"):!1}):!1}),Fe=(n,l,c)=>{const s=new Date(n);s.setHours(0,0,0,0);const r=new Date(n);r.setHours(23,59,59,999);const i=l.filter(t=>{const o=t.startTime.toDate?t.startTime.toDate():new Date(t.startTime),f=t.endTime?t.endTime.toDate?t.endTime.toDate():new Date(t.endTime):new Date;return o>r||f<s?!1:(t.itemIds||(t.itemId?[t.itemId]:[])).some(C=>{const S=c.find(q=>q.id===C);if(!S)return!1;const R=(S.mainCategory||"").toLowerCase(),M=(S.subCategory||"").toLowerCase();return R.includes("nylon")||M.includes("strumpfhose")||M.includes("stockings")})}).map(t=>{const o=t.startTime.toDate?t.startTime.toDate():new Date(t.startTime),f=t.endTime?t.endTime.toDate?t.endTime.toDate():new Date(t.endTime):new Date;return{start:Math.max(o.getTime(),s.getTime()),end:Math.min(f.getTime(),r.getTime())}}).filter(t=>t.end>t.start);if(i.length===0)return 0;i.sort((t,o)=>t.start-o.start);const D=[];let u=i[0];for(let t=1;t<i.length;t++)i[t].start<u.end?u.end=Math.max(u.end,i[t].end):(D.push(u),u=i[t]);D.push(u);const a=D.reduce((t,o)=>t+(o.end-o.start),0);return Math.floor(a/6e4)};function Xe(n,l,c){const{currentUser:s}=He(),[r,T]=x.useState({totalReleases:0,cleanReleases:0,keptOn:0}),[i,D]=x.useState([]),[u,a]=x.useState({health:{orphanCount:0},financials:{avgCPW:"0.00"},usage:{nylonIndex:"0.0"},spermaScore:{rate:"0.0",total:0,count:0},coreMetrics:{nylonEnclosure:"0.0",nocturnal:"0.0",nylonGap:"0m",cpnh:"0.00",complianceLag:"0m",coverage:"0.0",resistance:"0.0",voluntarism:"0.0%",endurance:"0m",enduranceNylon:"0m",enduranceDessous:"0m",submission:"85.0",denial:"12.0",chastity:"0.0"},femIndex:{score:0,trend:"neutral",subScores:{physis:0,psyche:0,infiltration:0}},basics:{activeItems:0,washing:0,wornToday:0,archived:0}});return x.useEffect(()=>{if(s&&c===void 0){const t=_e(ke(De,`users/${s.uid}/sessions`),$e("startTime",">=",$),Pe("startTime","desc")),o=he(t,f=>{const g=f.docs.map(C=>({id:C.id,...C.data()}));D(g)});return()=>o()}},[s,c]),x.useEffect(()=>{if(!s)return;const t=qe(De,`users/${s.uid}/stats/releaseStats`),o=he(t,f=>{if(f.exists()){const g=f.data();T({totalReleases:Number(g.totalReleases)||0,cleanReleases:Number(g.cleanReleases)||0,keptOn:Number(g.keptOn)||0})}});return()=>o()},[s]),x.useEffect(()=>{if(!Array.isArray(n))return;let t=[];c!==void 0?t=c:i.length>0?t=i:t=l||[];const o=t.filter(e=>(e.startTime.toDate?e.startTime.toDate():new Date(e.startTime))>=$),f=n.filter(e=>e.status==="active"),g=n.filter(e=>e.status==="washing"),C=n.filter(e=>e.status==="archived"),S=n.filter(e=>e.status==="active"&&(!e.wearCount||e.wearCount===0)).length;let R=0,M=0;n.forEach(e=>{R+=parseFloat(e.cost)||0,M+=parseInt(e.wearCount)||0});const q=M>0?R/M:0,Q=n.filter(e=>e.status!=="archived"&&(e.mainCategory&&e.mainCategory==="Nylons"||e.subCategory&&e.subCategory.toLowerCase().includes("strumpfhose"))),E=new Date,V=new Date;V.setDate(E.getDate()-30);const ve=t.filter(e=>(e.endTime?e.endTime.toDate?e.endTime.toDate():new Date(e.endTime):new Date)>=V);let X=0;const z=new Set;ve.forEach(e=>{const m=e.itemIds||(e.itemId?[e.itemId]:[]);let I=!1;if(m.forEach(d=>{const b=n.find(_=>_.id===d);if(!b)return;const y=b.mainCategory||"",w=(b.subCategory||"").toLowerCase();(y==="Nylons"||w.includes("strumpfhose")||w.includes("stockings"))&&(I=!0,z.add(d))}),I){const d=e.startTime.toDate?e.startTime.toDate():new Date(e.startTime),b=e.endTime?e.endTime.toDate?e.endTime.toDate():new Date(e.endTime):new Date,y=d<V?V:d,w=b;w>y&&(X+=(w-y)/6e4)}});const Ce=z.size>0?X/z.size/60:0,Me=Q.reduce((e,m)=>e+(Number(m.totalMinutes)||0),0),Ie=Q.reduce((e,m)=>e+(Number(m.cost)||0),0),Z=Me/60,be=Z>0?Ie/Z:0,ee=We(t);let O=0,te=0;const L=new Date($);for(;L<=E;){O++;const e=new Date(L);e.setHours(2,0,0,0),e<=E&&Ge(e,t,n)&&te++,L.setDate(L.getDate()+1)}const ne=O>0?te/O*100:0;let ae=0,j=0;const N=new Date($);for(;N<=E;){j++;const e=Fe(N,t,n);ae+=(1440-e)/60,N.setDate(N.getDate()+1)}const xe=j>0?ae/j:24;let A=0,se=0,oe=0,W=0;o.forEach(e=>{const m=e.startTime.toDate?e.startTime.toDate():new Date(e.startTime),I=e.endTime?e.endTime.toDate?e.endTime.toDate():new Date(e.endTime):new Date,d=Math.max(0,I.getTime()-m.getTime());A+=d,e.type==="voluntary"&&(se+=d),typeof e.complianceLagMinutes=="number"&&(oe+=e.complianceLagMinutes,W++)});const re=A>0?se/A*100:0,ie=o.length>0?o.filter(e=>e.type==="punishment").length/o.length*100:0,ce=W>0?oe/W:0,Se=o.filter(e=>e.startTime);let H=0,G=0,F=0,K=0,le=0,B=0;Se.forEach(e=>{const m=e.startTime.toDate?e.startTime.toDate():new Date(e.startTime),I=e.endTime?e.endTime.toDate?e.endTime.toDate():new Date(e.endTime):new Date,d=Math.max(0,(I-m)/36e5),y=(e.itemIds||(e.itemId?[e.itemId]:[])).map(h=>n.find(p=>p.id===h)).filter(h=>h);if(y.length===0)return;const w=y.some(h=>{const p=(h.subCategory||"").toLowerCase();return(h.mainCategory||"").toLowerCase().includes("nylon")||p.includes("strumpfhose")||p.includes("stockings")}),_=y.some(h=>{const p=(h.subCategory||"").toLowerCase(),P=(h.mainCategory||"").toLowerCase();return P.includes("dessous")||P.includes("wÃ¤sche")||p.includes("body")||p.includes("slip")||p.includes("bh")||P.includes("corsage")});(w||_)&&(H+=d,G++),w&&(F+=d,K++),_&&(le+=d,B++)});const ue=G>0?H/G:0,Re=K>0?F/K:0,Ee=B>0?le/B:0,U=H>0?F/H*100:0,Ve=r.totalReleases>0?r.cleanReleases/r.totalReleases*100:0,de=Math.min(100,ue/12*100)*.4+U*.6,Le=Math.max(0,100-ce*1.6),me=Math.max(0,re*.6+Le*.4-ie*2),fe=ne*.5+ee*.5,Ne=Math.round(de*.3+me*.3+fe*.4);a({health:{orphanCount:S},financials:{avgCPW:Te(q)},usage:{nylonIndex:v(Ce)},spermaScore:{rate:v(Ve),total:r.totalReleases,count:r.cleanReleases},coreMetrics:{nylonEnclosure:v(U),nocturnal:v(ne),nylonGap:k(xe),cpnh:Te(be),complianceLag:pe(ce),coverage:v(ee),resistance:v(ie),voluntarism:v(re)+"%",endurance:k(ue),enduranceNylon:k(Re),enduranceDessous:k(Ee),submission:"85.0",denial:"12.0",chastity:v(U)},femIndex:{score:Math.min(100,Ne),trend:"stable",subScores:{physis:Math.round(de),psyche:Math.round(me),infiltration:Math.round(fe)}},basics:{activeItems:f.length,washing:g.length,wornToday:uniqueItemsToday.size,archived:C.length}})},[n,l,c,i,r]),u}var J={},Ke=ge;Object.defineProperty(J,"__esModule",{value:!0});var Be=J.default=void 0,Ue=Ke(ye()),Ye=we;Be=J.default=(0,Ue.default)((0,Ye.jsx)("path",{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11z"}),"Security");export{Oe as a,Be as d,Xe as u};
