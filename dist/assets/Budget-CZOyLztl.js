import{m as I,n as P,j as e,u as X,a2 as Y,r as c,o as j,p as d,q as ee,t as b,x as R,y as k,A as te,E as F,z,B as l,D as n,C as se,T as s,V as p,P as a,a as x,K as ae}from"./index-DIK8iSn5.js";import{d as ne}from"./Warning-BVAQD8gC.js";import{d as re}from"./CheckCircle-DajygkMC.js";import{L as ie}from"./LinearProgress-DYfdcsqD.js";import{S as u,T as oe}from"./TextField-B-5n5mXs.js";import{C as ce}from"./Modal-BAiw1CyQ.js";import{D as le,a as de,b as xe}from"./DialogTitle-CPmaJbBl.js";import{D as ue}from"./DialogActions-DCNkcmJu.js";var v={},ge=I;Object.defineProperty(v,"__esModule",{value:!0});var W=v.default=void 0,he=ge(P()),pe=e;W=v.default=(0,he.default)((0,pe.jsx)("path",{d:"M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2M1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2"}),"ShoppingCart");var y={},me=I;Object.defineProperty(y,"__esModule",{value:!0});var M=y.default=void 0,fe=me(P()),je=e;M=y.default=(0,fe.default)((0,je.jsx)("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward");function _e(){var E,A;const{currentUser:o}=X(),T=Y(),[be,S]=c.useState(!0),[r,m]=c.useState({monthlyLimit:100,currentSpent:0}),[q,g]=c.useState(!1),[w,C]=c.useState(100),[L,G]=c.useState([]),[$,N]=c.useState([]);c.useEffect(()=>{o&&K()},[o]);const K=async()=>{S(!0);try{const t=j(d,`users/${o.uid}/settings/budget`),f=await ee(t);f.exists()?(m(f.data()),C(f.data().monthlyLimit)):await b(t,{monthlyLimit:100,currentSpent:0});const U=R(k(d,`users/${o.uid}/wishlist`),te("createdAt","desc")),Q=await F(U);G(Q.docs.map(i=>({id:i.id,...i.data(),cost:i.data().estimatedCost||i.data().cost||i.data().price||0})));const V=k(d,`users/${o.uid}/items`),Z=R(V,z("condition","<=",2),z("status","==","active")),J=await F(Z);N(J.docs.map(i=>({id:i.id,...i.data()})))}catch(t){console.error("Fehler beim Laden:",t)}finally{S(!1)}},O=async()=>{const t={...r,monthlyLimit:parseFloat(w)};await b(j(d,`users/${o.uid}/settings/budget`),t),m(t),g(!1)},H=async()=>{if(window.confirm("Neuen Monat starten? Ausgaben werden auf 0 gesetzt.")){const t={...r,currentSpent:0};await b(j(d,`users/${o.uid}/settings/budget`),t),m(t)}},h=r.monthlyLimit-(r.currentSpent||0),B=Math.min((r.currentSpent||0)/r.monthlyLimit*100,100),_=L.filter(t=>t.cost>0&&t.cost<=h),D=L.filter(t=>t.cost>h||t.cost===0);return e.jsx(l,{sx:n.bottomNavSpacer,children:e.jsxs(se,{maxWidth:"sm",sx:{pt:2},children:[e.jsx(s,{variant:"h4",gutterBottom:!0,sx:n.textGradient,children:"Budget"}),e.jsxs(p,{sx:{p:3,mb:3,...n.glassCard,textAlign:"center"},children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",children:"VERFÜGBAR"}),e.jsxs(s,{variant:"h2",sx:{fontWeight:"bold",color:h<0?a.accents.red:"#fff",my:1},children:[h.toFixed(2)," €"]}),e.jsx(ie,{variant:"determinate",value:B,sx:{height:8,borderRadius:4,mb:1,bgcolor:"rgba(255,255,255,0.1)","& .MuiLinearProgress-bar":{bgcolor:B>90?a.accents.red:a.accents.green}}}),e.jsxs(u,{direction:"row",justifyContent:"space-between",sx:{mb:2},children:[e.jsxs(s,{variant:"caption",sx:{color:a.text.secondary},children:["Ausgegeben: ",(E=r.currentSpent)==null?void 0:E.toFixed(2),"€"]}),e.jsxs(s,{variant:"caption",sx:{color:a.text.secondary},children:["Limit: ",(A=r.monthlyLimit)==null?void 0:A.toFixed(2),"€"]})]}),e.jsxs(u,{direction:"row",spacing:2,justifyContent:"center",children:[e.jsx(x,{size:"small",sx:n.buttonSecondary,onClick:()=>g(!0),children:"Limit ändern"}),e.jsx(x,{size:"small",variant:"outlined",color:"warning",onClick:H,children:"Reset"})]})]}),$.length>0&&e.jsxs(l,{sx:{mb:4},children:[e.jsxs(s,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1,mb:1,color:a.accents.gold},children:[e.jsx(ne,{fontSize:"small"})," Ersatz notwendig"]}),e.jsx(u,{spacing:1,children:$.map(t=>e.jsxs(p,{sx:{p:1.5,display:"flex",alignItems:"center",gap:2,bgcolor:`${a.accents.gold}15`,border:`1px solid ${a.accents.gold}40`},children:[e.jsx(ae,{src:t.imageUrl,variant:"rounded",sx:{width:40,height:40,bgcolor:"transparent"},children:"!"}),e.jsxs(l,{sx:{flexGrow:1},children:[e.jsx(s,{variant:"body2",fontWeight:"bold",children:t.name}),e.jsxs(s,{variant:"caption",color:"text.secondary",children:["Zustand: ",t.condition,"/5"]})]}),e.jsx(ce,{label:"Kaufen",sx:{bgcolor:a.accents.gold,color:"black",fontWeight:"bold"},size:"small",onClick:()=>window.open(`https://www.google.com/search?q=${t.brand}+${t.model}`,"_blank")})]},t.id))})]}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[e.jsxs(s,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(W,{fontSize:"small",sx:{color:a.primary.main}})," Empfehlungen"]}),e.jsx(x,{endIcon:e.jsx(M,{}),onClick:()=>T("/wishlist"),color:"inherit",children:"Zur Wishlist"})]}),_.length>0?e.jsx(u,{spacing:1,sx:{mb:3},children:_.map(t=>e.jsx(p,{sx:{p:2,...n.glassCard,borderLeft:`4px solid ${a.accents.green}`},children:e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(l,{children:[e.jsx(s,{variant:"subtitle1",children:t.name}),e.jsxs(s,{variant:"caption",sx:{color:a.accents.green},children:["Im Budget! (",t.cost," €)"]})]}),e.jsx(re,{sx:{color:a.accents.green}})]})},t.id))}):e.jsx(s,{variant:"body2",color:"text.secondary",paragraph:!0,children:"Keine Wünsche passen aktuell in das verbleibende Budget."}),D.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(s,{variant:"subtitle2",color:"text.secondary",sx:{mt:2,mb:1},children:"Sparen für:"}),e.jsx(u,{spacing:1,children:D.map(t=>e.jsx(p,{sx:{p:1.5,opacity:.6,bgcolor:a.background.lightGlass,border:`1px solid ${a.background.glassBorder}`},children:e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(s,{variant:"body2",children:t.name}),e.jsx(s,{variant:"body2",children:t.cost>0?`${t.cost} €`:"Preis ?"})]})},t.id))})]}),e.jsxs(le,{open:q,onClose:()=>g(!1),PaperProps:n.dialog.paper,children:[e.jsx(de,{sx:n.dialog.title.sx,children:"Monatslimit setzen"}),e.jsx(xe,{sx:n.dialog.content.sx,children:e.jsx(oe,{autoFocus:!0,margin:"dense",label:"Betrag in €",type:"number",fullWidth:!0,value:w,onChange:t=>C(t.target.value),sx:{mt:1,...n.inputField}})}),e.jsxs(ue,{sx:n.dialog.actions.sx,children:[e.jsx(x,{onClick:()=>g(!1),color:"inherit",children:"Abbrechen"}),e.jsx(x,{onClick:O,variant:"contained",sx:n.buttonGradient,children:"Speichern"})]})]})]})})}export{_e as default};
